<div class="l-container g-fade-in">
    <!-- #region Header -->

    <div class="l-header-container">
        <div class="l-header">
            <img
                class="l-back-icon"
                src="./assets/icons/back-arrow-icon.svg"
                alt="back-arrow-icon"
                (click)="handleSaveAndCloseModal()"
            />
            <h2 class="g-text-h2-dark">Delivery Point Setup</h2>
        </div>

        <div class="d-flex flex-row m-3">
            <img class="g-form-info-icon mt-1" src="./assets/icons/info-icon-grey.svg" alt="info-icon-grey" />
            <p class="g-form-info-p mb-0">
                {{
                    !publicDeliveryPoints.length && !userDeliveryPoints.length
                        ? "You haven't created any Delivery Point's yet. Create your own delivery point by clicking the button below."
                        : 'Select a Delivery Point option as part of the process of creating a New Lot.'
                }}
            </p>
        </div>
    </div>

    <!-- #endregion -->

    <!-- #region Content -->

    <div class="l-content">
        <!-- #region Public Delivery Points -->

        <div *ngIf="publicDeliveryPoints.length" class="w-100 mt-3">
            <label class="g-text-h2-dark mb-3"><b>Public delivery points</b></label>
            <div class="d-flex flex-row">
                <input
                    type="text"
                    class="l-input g-text-input"
                    [(ngModel)]="searchTerm"
                    (ngModelChange)="handleSearchTermChange($event)"
                    placeholder="Search by Silo, Mills or Farms."
                    [matAutocomplete]="auto"
                />
                <mat-autocomplete
                    #auto="matAutocomplete"
                    class="g-mat-autocomplete"
                    (optionSelected)="handleSelectDeliveryPoint($event.option.value)"
                >
                    <mat-option
                        class="g-mat-option-text"
                        *ngFor="let filteredDeliveryPoint of filteredDeliveryPoints"
                        [value]="filteredDeliveryPoint"
                    >
                        {{ filteredDeliveryPoint.name }}
                    </mat-option>
                </mat-autocomplete>
                <div class="l-search-container">
                    <img
                        class="l-search-icon"
                        (click)="handleSearchIconClick()"
                        [src]="
                            !searchTerm || searchTerm === ''
                                ? './assets/icons/search-white-icon.svg'
                                : './assets/icons/close-icon.svg'
                        "
                        alt="search-white-icon"
                    />
                </div>
            </div>
            <div class="d-flex flex-row m-1">
                <img class="g-form-info-icon mt-1" src="./assets/icons/info-icon-grey.svg" alt="info-icon-grey" />
                <p class="g-form-info-p mb-0">
                    If your nearest Silo or Mill is not listed, please create the delivery point below.
                </p>
            </div>
        </div>

        <!-- #region Button -->

        <button
            mat-flat-button
            [disabled]="!selectedDeliveryPointId"
            class="mt-3"
            [ngClass]="{
                'g-primary-button': selectedDeliveryPointId,
                'g-disabled-button': !selectedDeliveryPointId
            }"
            (click)="handleSaveAndCloseModal()"
        >
            Save Selected Delivery Point
        </button>

        <!-- #endregion -->

        <!-- #endregion -->

        <!-- #region Create Own Delivery Point Button -->

        <div *ngIf="!userDeliveryPoints.length; else showMyDeliveryPoints" class="w-100 mt-4">
            <p *ngIf="publicDeliveryPoints.length" class="g-text-p mb-4"><b>OR</b></p>
            <button
                mat-flat-button
                class="w-100 g-primary-button"
                [class.g-btn-disabled]="searchTerm && searchTerm !== ''"
                [disabled]="searchTerm && searchTerm !== ''"
                (click)="handleToggleIsCreateOwn()"
            >
                Create own delivery point
            </button>
        </div>

        <!-- #endregion -->

        <!-- #region User Delivery Points -->

        <ng-template #showMyDeliveryPoints>
            <div class="w-100" [ngClass]="publicDeliveryPoints.length ? 'mt-4' : 'mt-3'">
                <p class="g-text-h2-dark text-left mb-3"><b>My delivery points</b></p>
                <div class="l-user-delivery-point l-primary-bg" (click)="handleToggleIsCreateOwn()">
                    <p class="g-text-p text-white">Create new delivery point</p>
                    <img class="l-existing-icon" src="./assets/icons/plus-icon-white.svg" alt="plus-icon" />
                </div>
                <div
                    *ngFor="let userDeliveryPoint of userDeliveryPoints"
                    class="l-user-delivery-point"
                    (click)="handleSelectUserDeliveryPoint(userDeliveryPoint)"
                >
                    <p class="g-text-p l-delivery-name">{{ userDeliveryPoint.name }}</p>
                    <mat-checkbox
                        class="g-mat-checkbox"
                        [checked]="selectedDeliveryPointId === userDeliveryPoint.id"
                        disabled
                    ></mat-checkbox>
                </div>
            </div>
        </ng-template>

        <!-- #endregion -->
    </div>

    <!-- #endregion -->
</div>
